<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- ─── Meta de base ─────────────────────────────────────────── -->
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0,
                 maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0a001f" />
  <meta name="description"
        content="Neon Arena – Tower Defense néon en temps réel. Déploie tes unités, protège ton noyau, écrase l'ennemi." />

  <!-- ─── Open Graph ────────────────────────────────────────────── -->
  <meta property="og:title"       content="NΞØN ΔRΞNA ᶜˡᵃˢʰ" />
  <meta property="og:description" content="Tower Defense néon en temps réel." />
  <meta property="og:image"       content="assets/neon-arena-clash1.png" />
  <meta property="og:url"         content="https://neon-arena-clash.vercel.app" />
  <meta property="og:type"        content="website" />

  <!-- ─── Favicon SVG inline ───────────────────────────────────── -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
      <circle cx='50' cy='50' r='45' fill='none' stroke='%2300ffff' stroke-width='8'/>
      <circle cx='50' cy='50' r='30' fill='none' stroke='%23ff00ff' stroke-width='6'/>
      <text x='50' y='60' font-family='Arial Black' font-size='40'
            fill='%23ffffff' text-anchor='middle'>NA</text>
    </svg>" />

  <!-- ─── Google Fonts ──────────────────────────────────────────── -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap"
        rel="stylesheet" />

  <!-- ─── Phaser 3 ─────────────────────────────────────────────── -->
  <script defer src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

  <!-- ─── Styles ───────────────────────────────────────────────── -->
  <link rel="stylesheet" href="style.css" />

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%; overflow: hidden;
      background: #0a001f;
      font-family: 'Orbitron', 'Arial Black', sans-serif;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    #game-container { width: 100%; height: 100%; }

    /* ══ LOADER ══════════════════════════════════════════════════ */
    #loader {
      position: fixed; inset: 0;
      z-index: 9999;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      /* Titre en haut, barre en bas */
      align-items: center;
      justify-content: space-between;
      padding: clamp(36px, 6vh, 72px) clamp(20px, 5vw, 60px)
               clamp(28px, 5vh, 56px);
      transition: opacity 0.8s ease;
    }

    #loader.hidden { opacity: 0; pointer-events: none; }

    /* Image de fond plein écran */
    #loader-bg {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      object-position: center;
      filter: brightness(0.68) saturate(1.25);
    }

    /* Voile haut → bas pour lisibilité titre ET barre */
    #loader-veil {
      position: absolute; inset: 0;
      background:
        linear-gradient(
          to bottom,
          rgba(10, 0, 31, 0.72)  0%,    /* haut : titre lisible   */
          rgba(10, 0, 31, 0.10) 30%,    /* milieu : image visible */
          rgba(10, 0, 31, 0.10) 65%,    /* milieu : image visible */
          rgba(10, 0, 31, 0.88) 100%    /* bas : barre lisible    */
        );
      pointer-events: none;
    }

    /* ── Bloc titre (haut) ───────────────────────────────────── */
    #loader-top {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      /* Légère ligne déco sous le titre */
    }

    #loader-top::after {
      content: '';
      display: block;
      width: clamp(120px, 40vw, 320px);
      height: 1px;
      margin-top: 14px;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 208, 0, 0.6),
        rgba(79, 195, 247, 0.6),
        transparent
      );
    }

    /* ── Titre cyberpunk doré / bleu nuancé ─────────────────── */
    #loader-title {
      font-family: 'Orbitron', 'Arial Black', sans-serif;
      font-weight: 900;
      font-size: clamp(28px, 6.5vw, 72px);
      letter-spacing: clamp(2px, 1vw, 8px);
      text-transform: uppercase;
      text-align: center;
      line-height: 1.1;

      /* Dégradé doré → bleu */
      background: linear-gradient(
        135deg,
        #ffe066  0%,
        #ffd000 20%,
        #fff8c0 35%,
        #4fc3f7 55%,
        #0ea5e9 72%,
        #ffd000 88%,
        #ffe066 100%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 250% 250%;
      animation: shimmer 4s linear infinite;

      /* Glow réduit — subtil et élégant */
      filter:
        drop-shadow(0 0  4px rgba(255, 208,  0, 0.80))
        drop-shadow(0 0 12px rgba(255, 208,  0, 0.45))
        drop-shadow(0 0 22px rgba(14, 165, 233, 0.35));

      animation: shimmer 4s linear infinite, pulse-glow 3s ease-in-out infinite;
    }

    /* Superscript "ᶜˡᵃˢʰ" — plus petit, même dégradé */
    #loader-title sup {
      font-size: 0.38em;
      vertical-align: super;
      letter-spacing: 1px;
      opacity: 0.85;
    }

    /* Tagline */
    #loader-tagline {
      font-size: clamp(9px, 1.4vw, 14px);
      font-weight: 500;
      letter-spacing: clamp(3px, 1.2vw, 9px);
      color: rgba(79, 195, 247, 0.80);
      text-shadow: 0 0 8px rgba(79, 195, 247, 0.40);
      text-transform: uppercase;
    }

    /* ── Bloc bas (barre + hint) ─────────────────────────────── */
    #loader-bottom {
      position: relative;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }

    #loader-progress-wrap {
      width: min(520px, 88vw);
    }

    #loader-status {
      display: flex;
      justify-content: space-between;
      font-size: clamp(9px, 1.3vw, 12px);
      letter-spacing: 2px;
      color: rgba(255, 208, 0, 0.80);
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    #loader-bar-track {
      width: 100%; height: 5px;
      background: rgba(255, 255, 255, 0.07);
      border-radius: 99px;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(255, 208, 0, 0.18);
    }

    #loader-bar-fill {
      height: 100%; width: 0%;
      border-radius: 99px;
      background: linear-gradient(90deg, #ffd000, #4fc3f7, #ffd000);
      background-size: 200% 100%;
      box-shadow: 0 0 8px #ffd000, 0 0 18px #4fc3f7;
      animation:
        fill-bar    7s cubic-bezier(0.4, 0, 0.2, 1) forwards,
        bar-shimmer 1.8s linear infinite;
    }

    #loader-hint {
      font-size: clamp(9px, 1.2vw, 11px);
      letter-spacing: 3px;
      color: rgba(255, 255, 255, 0.25);
      text-transform: uppercase;
      animation: blink 2s ease-in-out infinite;
    }

    /* ── Keyframes ───────────────────────────────────────────── */
    @keyframes fill-bar {
      0%   { width:   0%; }
      15%  { width:  12%; }
      30%  { width:  28%; }
      48%  { width:  47%; }
      62%  { width:  63%; }
      78%  { width:  80%; }
      92%  { width:  94%; }
      100% { width: 100%; }
    }

    @keyframes bar-shimmer {
      0%   { background-position: 200% center; }
      100% { background-position:   0% center; }
    }

    @keyframes shimmer {
      0%   { background-position: 200% 50%; }
      100% { background-position:   0% 50%; }
    }

    @keyframes pulse-glow {
      0%, 100% {
        filter:
          drop-shadow(0 0  4px rgba(255, 208,  0, 0.80))
          drop-shadow(0 0 12px rgba(255, 208,  0, 0.45))
          drop-shadow(0 0 22px rgba(14, 165, 233, 0.35));
      }
      50% {
        filter:
          drop-shadow(0 0  6px rgba(255, 208,  0, 1.00))
          drop-shadow(0 0 18px rgba(255, 208,  0, 0.65))
          drop-shadow(0 0 32px rgba(14, 165, 233, 0.55));
      }
    }

    @keyframes blink {
      0%, 100% { opacity: 0.25; }
      50%       { opacity: 0.70; }
    }

    @media (prefers-reduced-motion: reduce) {
      #loader-bar-fill { animation: fill-bar 7s linear forwards; }
      #loader-title, #loader-hint { animation: none; }
    }
  </style>
</head>

<body>

  <!-- ═══ LOADER ══════════════════════════════════════════════════ -->
  <div id="loader" role="status" aria-label="Chargement de NΞØN ΔRΞNA ᶜˡᵃˢʰ">

    <img id="loader-bg"
         src="assets/neon-arena-clash1.png"
         alt="" aria-hidden="true" />

    <div id="loader-veil" aria-hidden="true"></div>

    <!-- HAUT : titre + tagline -->
    <div id="loader-top">
      <h1 id="loader-title">NΞØN&nbsp;ΔRΞNA<sup>ᶜˡᵃˢʰ</sup></h1>
      <p  id="loader-tagline">Clash&nbsp;&nbsp;·&nbsp;&nbsp;Tower&nbsp;Defense&nbsp;&nbsp;·&nbsp;&nbsp;Néon</p>
    </div>

    <!-- BAS : barre de progression -->
    <div id="loader-bottom">
      <div id="loader-progress-wrap"
           role="progressbar"
           aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
           aria-label="Progression du chargement">

        <div id="loader-status">
          <span id="loader-status-label">Initialisation…</span>
          <span id="loader-status-pct">0 %</span>
        </div>

        <div id="loader-bar-track">
          <div id="loader-bar-fill"></div>
        </div>
      </div>

      <p id="loader-hint" aria-hidden="true">Prépare toi au combat</p>
    </div>

  </div>

  <!-- ═══ CANVAS PHASER ═══════════════════════════════════════════ -->
  <div id="game-container"></div>

  <!-- ═══ SCRIPTS ═════════════════════════════════════════════════ -->
  <script defer src="main.js"></script>

  <script>
    (() => {
      const DURATION = 7000;
      const STEPS = [
        { at: 0.15, label: 'Initialisation…'      },
        { at: 0.30, label: 'Chargement assets…'   },
        { at: 0.48, label: 'Compilation shaders…' },
        { at: 0.63, label: 'Génération arène…'    },
        { at: 0.80, label: 'Synchro réseau…'      },
        { at: 0.94, label: 'Finalisation…'         },
        { at: 1.00, label: 'Prêt !'                },
      ];

      const loader      = document.getElementById('loader');
      const progressBar = document.getElementById('loader-progress-wrap');
      const statusLabel = document.getElementById('loader-status-label');
      const statusPct   = document.getElementById('loader-status-pct');

      const start = performance.now();
      let stepIndex = 0;
      let rafId;

      function tick(now) {
        const progress = Math.min((now - start) / DURATION, 1);
        const pct      = Math.round(progress * 100);

        while (stepIndex < STEPS.length && progress >= STEPS[stepIndex].at) {
          statusLabel.textContent = STEPS[stepIndex].label;
          stepIndex++;
        }

        statusPct.textContent = `${pct} %`;
        progressBar.setAttribute('aria-valuenow', pct);

        if (progress < 1) rafId = requestAnimationFrame(tick);
      }

      rafId = requestAnimationFrame(tick);

      let windowLoaded = false;
      let timerDone    = false;

      function tryHide() {
        if (windowLoaded && timerDone) {
          cancelAnimationFrame(rafId);
          loader.classList.add('hidden');
          loader.addEventListener('transitionend', () => loader.remove(), { once: true });
        }
      }

      setTimeout(() => { timerDone = true;    tryHide(); }, DURATION);
      window.addEventListener('load', () => { windowLoaded = true; tryHide(); });
    })();
  </script>

</body>
</html>
