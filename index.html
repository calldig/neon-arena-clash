<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- ─── Meta de base ─────────────────────────────────────────── -->
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0,
                 maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0a001f" />
  <meta name="description"
        content="NΞØN ΔRΞNA ᶜˡᵃˢʰ – Tower Defense néon en temps réel." />

  <!-- ─── Open Graph ────────────────────────────────────────────── -->
  <meta property="og:title"       content="NΞØN ΔRΞNA ᶜˡᵃˢʰ" />
  <meta property="og:description" content="Tower Defense néon en temps réel." />
  <meta property="og:image"       content="assets/neon-arena-clash1.png" />
  <meta property="og:url"         content="https://neon-arena-clash.vercel.app" />
  <meta property="og:type"        content="website" />

  <!-- ─── Favicon SVG inline ───────────────────────────────────── -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
      <circle cx='50' cy='50' r='45' fill='none' stroke='%2300ffff' stroke-width='8'/>
      <circle cx='50' cy='50' r='30' fill='none' stroke='%23ff00ff' stroke-width='6'/>
      <text x='50' y='60' font-family='Arial Black' font-size='40'
            fill='%23ffffff' text-anchor='middle'>NA</text>
    </svg>" />

  <!-- ─── Google Fonts ──────────────────────────────────────────── -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap"
        rel="stylesheet" />

  <!-- ─── Phaser 3 ─────────────────────────────────────────────── -->
  <script defer src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

  <!-- ─── Styles externes ──────────────────────────────────────── -->
  <link rel="stylesheet" href="style.css" />

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%; overflow: hidden;
      background: #04000e;
      font-family: 'Orbitron', 'Arial Black', sans-serif;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    #game-container { width: 100%; height: 100%; }

    /* ══════════════════════════════════════════════════════════
       LOADER
    ══════════════════════════════════════════════════════════ */
    #loader {
      position: fixed; inset: 0;
      z-index: 9999;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      /* Fond très sombre pour les bandes autour de l'image */
      background: #04000e;
      padding: clamp(28px, 5vh, 60px) clamp(16px, 4vw, 48px)
               clamp(24px, 4vh, 48px);
      transition: opacity 0.9s ease;
    }

    #loader.hidden { opacity: 0; pointer-events: none; }

    /* ── Image : visible en entier, sans recadrage ───────────── */
    #loader-bg {
      position: absolute;
      /* Centrée verticalement, légèrement remontée pour laisser
         la barre de progression visible en bas                   */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -48%);

      /* Taille max : l'image tient entièrement dans l'écran     */
      max-width:  100%;
      max-height: 88vh;   /* laisse 12 vh pour titre + barre     */
      width: auto;
      height: auto;

      /* Rendu propre */
      object-fit: contain;
      display: block;

      /* Légère correction de luminosité */
      filter: brightness(0.80) saturate(1.15);
    }

    /* Voile : sombre en haut et en bas, transparent au centre   */
    #loader-veil {
      position: absolute; inset: 0;
      background:
        linear-gradient(
          to bottom,
          rgba(4,  0, 14, 0.82)  0%,
          rgba(4,  0, 14, 0.05) 22%,
          rgba(4,  0, 14, 0.00) 45%,
          rgba(4,  0, 14, 0.00) 72%,
          rgba(4,  0, 14, 0.88) 100%
        );
      pointer-events: none;
    }

    /* ══ BLOC HAUT — titre ══════════════════════════════════════ */
    #loader-top {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    /* Ligne déco sous le tagline */
    #loader-top::after {
      content: '';
      display: block;
      width: clamp(100px, 38vw, 300px);
      height: 1px;
      margin-top: 10px;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(180, 100, 255, 0.55),
        rgba(255, 140,  80, 0.55),
        transparent
      );
    }

    /* ── Titre : violet → rose → orange (doux pour les yeux) ─── */
    #loader-title {
      font-family: 'Orbitron', 'Arial Black', sans-serif;
      font-weight: 900;
      font-size: clamp(26px, 6vw, 68px);
      letter-spacing: clamp(2px, 0.9vw, 7px);
      text-align: center;
      line-height: 1.1;

      /* ✦ Nouvelle palette : violet électrique → rose → orange chaud */
      background: linear-gradient(
        125deg,
        #c084fc  0%,    /* violet pastel     */
        #a855f7 15%,    /* violet vif        */
        #e879f9 30%,    /* rose magenta      */
        #fb923c 50%,    /* orange chaud      */
        #f472b6 68%,    /* rose bonbon       */
        #a78bfa 85%,    /* violet lavande    */
        #c084fc 100%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 220% 220%;

      /* Glow subtil — intensité réduite de moitié vs avant */
      filter:
        drop-shadow(0 0  3px rgba(168, 85, 247, 0.70))
        drop-shadow(0 0 10px rgba(168, 85, 247, 0.35))
        drop-shadow(0 0 20px rgba(251, 146, 60, 0.25));

      animation:
        title-shimmer  5s linear infinite,
        title-pulse    3.5s ease-in-out infinite;
    }

    #loader-title sup {
      font-size: 0.36em;
      vertical-align: super;
      letter-spacing: 1px;
      opacity: 0.80;
    }

    /* Tagline */
    #loader-tagline {
      font-size: clamp(9px, 1.3vw, 13px);
      font-weight: 500;
      letter-spacing: clamp(3px, 1vw, 8px);
      color: rgba(192, 132, 252, 0.75);
      text-shadow: 0 0 8px rgba(192, 132, 252, 0.30);
      text-transform: uppercase;
    }

    /* ══ BLOC BAS — progression ═════════════════════════════════ */
    #loader-bottom {
      position: relative;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    #loader-progress-wrap {
      width: min(500px, 88vw);
    }

    #loader-status {
      display: flex;
      justify-content: space-between;
      font-size: clamp(9px, 1.2vw, 11px);
      letter-spacing: 2px;
      color: rgba(251, 146, 60, 0.85);
      margin-bottom: 7px;
      text-transform: uppercase;
    }

    #loader-bar-track {
      width: 100%; height: 5px;
      background: rgba(255, 255, 255, 0.07);
      border-radius: 99px;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(168, 85, 247, 0.20);
    }

    #loader-bar-fill {
      height: 100%; width: 0%;
      border-radius: 99px;
      /* Barre : même palette que le titre */
      background: linear-gradient(
        90deg,
        #a855f7, #e879f9, #fb923c, #a855f7
      );
      background-size: 200% 100%;
      box-shadow:
        0 0  6px rgba(168,  85, 247, 0.80),
        0 0 14px rgba(251, 146,  60, 0.50);
      animation:
        fill-bar    7s cubic-bezier(0.4, 0, 0.2, 1) forwards,
        bar-shimmer 2s linear infinite;
    }

    #loader-hint {
      font-size: clamp(9px, 1.1vw, 11px);
      letter-spacing: 3px;
      color: rgba(255, 255, 255, 0.22);
      text-transform: uppercase;
      animation: blink 2.2s ease-in-out infinite;
    }

    /* ══ Keyframes ══════════════════════════════════════════════ */
    @keyframes fill-bar {
      0%   { width:   0%; }
      15%  { width:  12%; }
      30%  { width:  28%; }
      48%  { width:  47%; }
      62%  { width:  63%; }
      78%  { width:  80%; }
      92%  { width:  94%; }
      100% { width: 100%; }
    }

    @keyframes bar-shimmer {
      0%   { background-position: 200% center; }
      100% { background-position:   0% center; }
    }

    @keyframes title-shimmer {
      0%   { background-position: 200% 50%; }
      100% { background-position:   0% 50%; }
    }

    @keyframes title-pulse {
      0%, 100% {
        filter:
          drop-shadow(0 0  3px rgba(168, 85, 247, 0.70))
          drop-shadow(0 0 10px rgba(168, 85, 247, 0.35))
          drop-shadow(0 0 20px rgba(251, 146, 60, 0.25));
      }
      50% {
        filter:
          drop-shadow(0 0  5px rgba(168, 85, 247, 0.90))
          drop-shadow(0 0 15px rgba(168, 85, 247, 0.55))
          drop-shadow(0 0 28px rgba(251, 146, 60, 0.40));
      }
    }

    @keyframes blink {
      0%, 100% { opacity: 0.22; }
      50%       { opacity: 0.65; }
    }

    @media (prefers-reduced-motion: reduce) {
      #loader-bar-fill  { animation: fill-bar 7s linear forwards; }
      #loader-title, #loader-hint { animation: none; }
    }
  </style>
</head>

<body>

  <!-- ═══ LOADER SPLASH ═══════════════════════════════════════════ -->
  <div id="loader" role="status" aria-label="Chargement de NΞØN ΔRΞNA ᶜˡᵃˢʰ">

    <!-- Image complète, sans recadrage -->
    <img id="loader-bg"
         src="assets/neon-arena-clash1.png"
         alt="" aria-hidden="true" />

    <!-- Voile dégradé -->
    <div id="loader-veil" aria-hidden="true"></div>

    <!-- HAUT : titre -->
    <div id="loader-top">
      <h1 id="loader-title">NΞØN&nbsp;ΔRΞNA<sup>ᶜˡᵃˢʰ</sup></h1>
      <p  id="loader-tagline">Clash&nbsp;&nbsp;·&nbsp;&nbsp;Tower&nbsp;Defense&nbsp;&nbsp;·&nbsp;&nbsp;Néon</p>
    </div>

    <!-- BAS : barre de progression -->
    <div id="loader-bottom">
      <div id="loader-progress-wrap"
           role="progressbar"
           aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
           aria-label="Progression du chargement">

        <div id="loader-status">
          <span id="loader-status-label">Initialisation…</span>
          <span id="loader-status-pct">0 %</span>
        </div>

        <div id="loader-bar-track">
          <div id="loader-bar-fill"></div>
        </div>
      </div>

      <p id="loader-hint" aria-hidden="true">Prépare toi au combat</p>
    </div>

  </div>

  <!-- ═══ CANVAS PHASER ═══════════════════════════════════════════ -->
  <div id="game-container"></div>

  <!-- ═══ SCRIPTS ═════════════════════════════════════════════════ -->
  <script defer src="main.js"></script>

  <script>
    (() => {
      const DURATION = 7000;
      const STEPS = [
        { at: 0.15, label: 'Initialisation…'      },
        { at: 0.30, label: 'Chargement assets…'   },
        { at: 0.48, label: 'Compilation shaders…' },
        { at: 0.63, label: 'Génération arène…'    },
        { at: 0.80, label: 'Synchro réseau…'      },
        { at: 0.94, label: 'Finalisation…'        },
        { at: 1.00, label: 'Prêt !'               },
      ];

      const loader      = document.getElementById('loader');
      const progressBar = document.getElementById('loader-progress-wrap');
      const statusLabel = document.getElementById('loader-status-label');
      const statusPct   = document.getElementById('loader-status-pct');

      const start = performance.now();
      let stepIndex = 0, rafId;

      function tick(now) {
        const progress = Math.min((now - start) / DURATION, 1);
        const pct      = Math.round(progress * 100);

        while (stepIndex < STEPS.length && progress >= STEPS[stepIndex].at) {
          statusLabel.textContent = STEPS[stepIndex].label;
          stepIndex++;
        }

        statusPct.textContent = `${pct} %`;
        progressBar.setAttribute('aria-valuenow', pct);

        if (progress < 1) rafId = requestAnimationFrame(tick);
      }

      rafId = requestAnimationFrame(tick);

      let windowLoaded = false, timerDone = false;

      function tryHide() {
        if (!windowLoaded || !timerDone) return;
        cancelAnimationFrame(rafId);
        loader.classList.add('hidden');
        loader.addEventListener('transitionend', () => loader.remove(), { once: true });
      }

      setTimeout(() => { timerDone    = true; tryHide(); }, DURATION);
      window.addEventListener('load', () => { windowLoaded = true; tryHide(); });
    })();
  </script>

</body>
</html>
